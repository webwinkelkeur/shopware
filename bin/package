#!/bin/bash

set -euo pipefail
cd "$(dirname "$0")/.."

version="$(git describe --tags --match 'v*')"
zip="dist/webwinkelkeur-shopware-$version.zip"

composer_version="$(git show HEAD:./composer.json | jq -r .version)"
if [[ $composer_version != $version ]]; then
    echo "Warning: Version in composer.json ($composer_version) does not match tag!"
fi

mkdir -p "$(dirname "$zip")"
git archive -o "$zip" --prefix=webwinkelkeur/ HEAD composer.json src

echo "$zip" >&2
