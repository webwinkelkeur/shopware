#!/bin/bash
cd "$(dirname "$0")/.."
if [[ $# -ne 1 ]]; then
	echo "Usage: $0 <PROJECT>" >&2
	exit 1
fi

project="$1"


  set -a
  source $project.env
  set +a
  php templates/config.xml.php > $project/src/Resources/config/config.xml
  php templates/services.xml.php > $project/src/Resources/config/services.xml
  php templates/composer.json.php > $project/composer.json

  cp -r templates/views $project/src/Resources
  cp -r templates/routes.xml $project/src/Resources/config/routes.xml
  cp -r common $project

  controller_dir="$project/src/Storefront/Controller"
  mkdir -p "$controller_dir" && cp  templates/ApiController.php "${controller_dir}/${SYSTEM_NAME}ApiController.php"

  sed -i '' -e "s/{SYSTEM_KEY}/$SYSTEM_KEY/g" $project/src/Storefront/Controller/${SYSTEM_NAME}ApiController.php
  sed -i '' -e "s/{SYSTEM_NAME}/$SYSTEM_NAME/g" $project/src/Storefront/Controller/${SYSTEM_NAME}ApiController.php
